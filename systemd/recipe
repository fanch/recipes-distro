n=systemd
v=215
s=infra
u=http://www.freedesktop.org/software/$n/$n-$v.tar.xz

Src() {
	patch -Np1 < $rcs/0001-networkd-properly-track-addresses-when-first-added.patch

	./configure --prefix=$usr \
				--sysconfdir=$etc \
				--sbindir=$bin \
				--localstatedir=$var \
				--enable-introspection \
				--with-sysvinit-path= \
				--with-sysvrcnd-path= \
				--with-firmware-path=$lib/firmware \
				--without-python

	make
}

Pkg() {
	make DESTDIR=$pkg install

	# Replace dialout with uucpsu
	sed -i 's#GROUP="dialout"#GROUP="uucp"#g' $pkg/$lib/udev/rules.d/*.rules

	# ensure proper permissions for /var/log/journal
	chown root:systemd-journal $pkg/$var/log/journal
	chmod 2755 $pkg/$var/log/journal

	# fix pam file
	sed 's|system-auth|system-login|g' -i $pkg/$etc/pam.d/systemd-user

	for i in halt poweroff reboot runlevel shutdown telinit; do
	  ln -s systemctl $pkg/$bin/$i
	done

	ln -s ../lib/systemd/systemd $pkg/$bin/init
}
